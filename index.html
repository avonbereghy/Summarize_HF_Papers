<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HuggingFace Papers Daily Summary</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .intro {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .intro h1 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 2.5em;
        }

        .intro p {
            color: #666;
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto;
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            margin-top: 18px;
            flex-wrap: wrap;
        }

        .control-input {
            flex: 1 1 360px;
            max-width: 560px;
            background: #fff;
            border: 1px solid #e0e0e0;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 0.95em;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .control-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s ease-in-out, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(118,75,162,0.25);
        }

        .control-btn.secondary {
            background: #fff;
            color: #764ba2;
            border: 1px solid #d7c8e6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .calendar-container {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
        }

        .calendar-section {
            flex: 1;
            min-width: 300px;
        }

        .calendar {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        .calendar-header h2 {
            font-size: 1.3em;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .calendar-nav button:hover {
            background: rgba(255,255,255,0.3);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .calendar-weekday {
            text-align: center;
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-weight: 500;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f0f0f0;
        }

        .calendar-day.has-papers {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-papers::after {
            content: attr(data-count);
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 0.7em;
            background: rgba(255,255,255,0.3);
            padding: 2px 5px;
            border-radius: 3px;
        }

        .calendar-day.selected {
            background: #764ba2;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(118,75,162,0.3);
        }

        .summary-section {
            flex: 1.5;
            min-width: 400px;
        }

        .summary-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .summary-placeholder {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .summary-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .summary-header h3 {
            color: #764ba2;
            margin-bottom: 5px;
        }

        .paper-list {
            list-style: none;
        }

        .paper-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .paper-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .paper-item h4 {
            color: #764ba2;
            margin: 10px 0;
        }

        .paper-id {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .paper-id a {
            color: #667eea;
            text-decoration: none;
        }

        .paper-id a:hover {
            text-decoration: underline;
        }

        .paper-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .chip {
            font-size: 0.75em;
            background: #eef;
            color: #4a4a8a;
            border: 1px solid #dde;
            border-radius: 999px;
            padding: 2px 8px;
        }

        .paper-authors {
            font-size: 0.9em;
            color: #888;
            margin: 5px 0;
            font-style: italic;
        }

        .paper-summary {
            margin-top: 10px;
            line-height: 1.6;
            color: #555;
        }

        .paper-detail {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .paper-detail.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .paper-detail h2 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .paper-detail section {
            margin-bottom: 20px;
        }

        .paper-detail h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .paper-detail p, .paper-detail li {
            line-height: 1.8;
            color: #555;
        }

        .paper-detail ul {
            margin-left: 20px;
        }

        .paper-detail a {
            color: #764ba2;
            text-decoration: none;
        }

        .paper-detail a:hover {
            text-decoration: underline;
        }

        .match-count {
            color: #666;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            .calendar-container {
                flex-direction: column;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="intro">
            <h1>HuggingFace Papers Daily</h1>
            <p>Welcome! I'm passionate about machine learning and AI research. Here you'll find daily summaries of the latest papers from HuggingFace. Click on any highlighted date in the calendar to explore the papers published that day.</p>
            <div class="controls" role="region" aria-label="Controls">
                <input id="searchInput" class="control-input" type="search" placeholder="Search title, authors, ID, or summary…" aria-label="Search papers" oninput="onSearchInput()" />
                <button class="control-btn" onclick="goToLatest()" aria-label="Jump to latest with papers">Latest</button>
                <button class="control-btn secondary" onclick="goToToday()" aria-label="Jump to today">Today</button>
                <button class="control-btn secondary" onclick="clearSearch()" aria-label="Clear search">Clear</button>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-section">
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="previousMonth()">←</button>
                        <h2 id="currentMonth">August 2025</h2>
                        <button class="calendar-nav" onclick="nextMonth()">→</button>
                    </div>
                    <div class="calendar-weekdays">
                        <div class="calendar-weekday">Sun</div>
                        <div class="calendar-weekday">Mon</div>
                        <div class="calendar-weekday">Tue</div>
                        <div class="calendar-weekday">Wed</div>
                        <div class="calendar-weekday">Thu</div>
                        <div class="calendar-weekday">Fri</div>
                        <div class="calendar-weekday">Sat</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>
            </div>

            <div class="summary-section">
                <div class="summary-container" id="summaryContainer">
                    <div class="summary-placeholder">
                        <h3>Select a date to view papers</h3>
                        <p>Click on highlighted dates in the calendar to see the paper summaries for that day.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Paper data structure - will be loaded from data.json
        let papersData = {};
        let currentDate = new Date();
        let selectedDate = null;
        let loadedSummaries = {}; // cache: dateStr -> [{id, displayId, summaryText, path, title, authors, url}]
        let currentFilter = '';

        // Initialize calendar
        async function init() {
            await loadPapersData();
            const urlDate = getDateFromURL();
            const savedDate = localStorage.getItem('lastSelectedDate');
            const initialDate = urlDate || savedDate || getLatestDateWithPapers();
            if (initialDate) {
                const [y, m] = initialDate.split('-');
                currentDate = new Date(Number(y), Number(m) - 1, 1);
                await selectDate(initialDate, { pushHistory: false });
            }
            renderCalendar();
        }

        // Load papers data from data.json
        async function loadPapersData() {
            try {
                const response = await fetch('data.json');
                if (response.ok) {
                    const data = await response.json();
                    papersData = data.papers || {};
                    console.log(`Loaded data for ${Object.keys(papersData).length} dates`);
                } else {
                    console.error('Failed to load data.json');
                    papersData = {};
                }
            } catch (error) {
                console.error('Error loading data.json:', error);
                papersData = {};
            }
        }

        function getDateFromURL() {
            const params = new URLSearchParams(window.location.search);
            const date = params.get('date');
            if (date && /^\d{4}-\d{2}-\d{2}$/.test(date)) return date;
            return null;
        }

        function setDateInURL(dateStr, replace = false) {
            const url = new URL(window.location.href);
            url.searchParams.set('date', dateStr);
            if (replace) {
                window.history.replaceState({}, '', url.toString());
            } else {
                window.history.pushState({}, '', url.toString());
            }
        }

        function getLatestDateWithPapers() {
            const dates = Object.keys(papersData).sort();
            return dates.length ? dates[dates.length - 1] : null;
        }

        // Get papers for a given date
        function getPapersForDate(dateStr) {
            return papersData[dateStr] || [];
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month header
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Clear calendar grid
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            // Add empty cells for days before month starts
            for (let i = firstDay - 1; i >= 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = daysInPrevMonth - i;
                grid.appendChild(dayElement);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Format date string as YYYY-MM-DD
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Check if this date has papers
                const papers = getPapersForDate(dateStr);
                if (papers.length > 0) {
                    dayElement.className += ' has-papers';
                    dayElement.setAttribute('data-count', papers.length);
                    dayElement.onclick = () => selectDate(dateStr);
                }
                
                // Highlight selected date
                if (selectedDate === dateStr) {
                    dayElement.className += ' selected';
                }
                
                grid.appendChild(dayElement);
            }
            
            // Add empty cells for remaining week
            const totalCells = grid.children.length;
            const remainingCells = 42 - totalCells; // 6 weeks * 7 days
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = day;
                grid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        async function selectDate(dateStr, options = {}) {
            selectedDate = dateStr;
            renderCalendar();
            
            const container = document.getElementById('summaryContainer');
            container.innerHTML = '<div class="loading">Loading papers</div>';
            
            // Display papers for the selected date
            await displayPapers(dateStr);
            localStorage.setItem('lastSelectedDate', dateStr);
            setDateInURL(dateStr, options?.pushHistory === false);
        }

        async function displayPapers(dateStr) {
            const container = document.getElementById('summaryContainer');
            const papers = getPapersForDate(dateStr);
            
            if (papers.length === 0) {
                container.innerHTML = '<div class="summary-placeholder"><h3>No papers available</h3><p>No papers found for this date.</p></div>';
                return;
            }
            
            if (!loadedSummaries[dateStr]) {
                const foundPapers = [];
                for (const paper of papers) {
                    try {
                        const summaryPath = `${paper.path}/summary.md`;
                        const response = await fetch(summaryPath);
                        if (response.ok) {
                            const summaryText = await response.text();
                            if (summaryText && summaryText.trim() !== '') {
                                const titleMatch = summaryText.match(/^# (.+)$/m);
                                const title = titleMatch ? titleMatch[1] : `Paper ${paper.id}`;
                                const idMatch = summaryText.match(/\*\*Paper ID:\*\* (.+)$/m);
                                const displayId = idMatch ? idMatch[1] : paper.id;
                                const authorsMatch = summaryText.match(/\*\*Authors:\*\* (.+)$/m);
                                const authors = authorsMatch ? authorsMatch[1] : '';
                                const urlMatch = summaryText.match(/\*\*URL:\*\* (.+)$/m);
                                const paperUrl = urlMatch ? urlMatch[1] : `https://arxiv.org/abs/${displayId}`;

                                foundPapers.push({ 
                                    id: paper.id,
                                    displayId,
                                    summaryText,
                                    path: paper.path,
                                    title,
                                    authors,
                                    url: paperUrl
                                });
                            }
                        }
                    } catch (error) {
                        console.error(`Error loading paper ${paper.id}:`, error);
                    }
                }
                loadedSummaries[dateStr] = foundPapers;
            }
            
            if ((loadedSummaries[dateStr] || []).length === 0) {
                container.innerHTML = '<div class="summary-placeholder"><h3>Error loading papers</h3><p>Could not load paper summaries for this date.</p></div>';
                return;
            }
            
            renderPapersForDate(dateStr);
        }

        function renderPapersForDate(dateStr) {
            const container = document.getElementById('summaryContainer');
            const papers = loadedSummaries[dateStr] || [];
            const filter = (currentFilter || '').toLowerCase();

            const filtered = !filter
                ? papers
                : papers.filter(p => {
                    const execSummaryMatch = p.summaryText.match(/## Executive Summary\s+([\s\S]*?)(?=\n##|$)/);
                    const execSummary = execSummaryMatch ? execSummaryMatch[1].trim() : '';
                    return (
                        p.title.toLowerCase().includes(filter) ||
                        (p.authors || '').toLowerCase().includes(filter) ||
                        p.displayId.toLowerCase().includes(filter) ||
                        execSummary.toLowerCase().includes(filter)
                    );
                });

            const matchInfo = filter ? `<span class="match-count">Showing ${filtered.length} of ${papers.length} papers</span>` : `<span class="match-count">${papers.length} papers available</span>`;

            let html = `
                <div class="summary-content">
                    <div class="summary-header">
                        <h3>Papers for ${dateStr}</h3>
                        <div style="display:flex; align-items:center; gap:8px; flex-wrap: wrap;">
                            ${matchInfo}
                            <button class="control-btn secondary" onclick="expandAll()" aria-label="Expand all">Expand all</button>
                            <button class="control-btn secondary" onclick="collapseAll()" aria-label="Collapse all">Collapse all</button>
                        </div>
                    </div>
                    <ul class="paper-list">
            `;

            for (const paper of filtered) {
                const execSummaryMatch = paper.summaryText.match(/## Executive Summary\s+([\s\S]*?)(?=\n##|$)/);
                const execSummary = execSummaryMatch ? execSummaryMatch[1].trim() : 'Summary not available';

                const pdfUrl = paper.url.includes('arxiv.org')
                    ? paper.url.replace('/abs/', '/pdf/') + '.pdf'
                    : paper.url;

                const hTitle = highlight(paper.title, filter);
                const hAuthors = highlight(paper.authors || 'Authors not available', filter);
                const hSummary = highlight(execSummary, filter);

                html += `
                    <li class="paper-item" onclick="togglePaperDetail('${paper.id}')">
                        <div class="paper-id">
                            Paper #${paper.displayId}
                            <span class="chip">${paper.displayId.startsWith('arXiv') ? 'arXiv' : 'ID'}</span>
                            | <a href="${paper.url}" target="_blank" onclick="event.stopPropagation();">View</a>
                            | <a href="${pdfUrl}" target="_blank" onclick="event.stopPropagation();">PDF</a>
                        </div>
                        <h4>${hTitle}</h4>
                        <div class="paper-authors">${hAuthors}</div>
                        <div class="paper-summary">${hSummary}</div>
                    </li>
                    <div class="paper-detail" id="detail-${paper.id}">
                        <div style="white-space: pre-wrap; font-family: inherit;">${paper.summaryText}</div>
                    </div>
                `;
            }

            html += `
                    </ul>
                </div>
            `;

            container.innerHTML = html;
        }

        function highlight(text, filter) {
            if (!filter) return escapeHtml(text);
            const safe = escapeHtml(text);
            try {
                const re = new RegExp(`(${filter.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'ig');
                return safe.replace(re, '<mark>$1</mark>');
            } catch {
                return safe;
            }
        }

        function escapeHtml(text) {
            return String(text)
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;');
        }

        function expandAll() {
            document.querySelectorAll('.paper-detail').forEach(d => d.classList.add('active'));
        }

        function collapseAll() {
            document.querySelectorAll('.paper-detail').forEach(d => d.classList.remove('active'));
        }

        function onSearchInput() {
            currentFilter = (document.getElementById('searchInput').value || '').trim();
            if (selectedDate) renderPapersForDate(selectedDate);
        }

        function clearSearch() {
            const el = document.getElementById('searchInput');
            el.value = '';
            currentFilter = '';
            if (selectedDate) renderPapersForDate(selectedDate);
        }

        function goToLatest() {
            const latest = getLatestDateWithPapers();
            if (latest) selectDate(latest);
        }

        function goToToday() {
            const d = new Date();
            const dateStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
            currentDate = new Date(d.getFullYear(), d.getMonth(), 1);
            renderCalendar();
            if (getPapersForDate(dateStr).length) selectDate(dateStr);
        }

        function togglePaperDetail(paperId) {
            const detail = document.getElementById(`detail-${paperId}`);
            const allDetails = document.querySelectorAll('.paper-detail');
            
            allDetails.forEach(d => {
                if (d !== detail) {
                    d.classList.remove('active');
                }
            });
            
            detail.classList.toggle('active');
        }

        // Initialize on page load
        init();
    </script>
</body>
</html>
